---
layout:     post
title:      "JVM - Daily Notes - 03"
subtitle:   " \"JAVA Knowledge - JVM\""
date:       2020.12.21 12:29:00
author:     "Wuy"
header-img: "img/post-bg-2020.jpg"
catalog: true
tags:
    - 学习笔记
    - 读书
    - JVM

---

> *"Keep Learning JVM"*

# Java 类加载器

类的加载过程主要是：加载->链接（验证->准备->解析）->初始化

## Java类加载器子系统作用

1. 类加载器子系统负责从文件系统或者网络中加载`class`文件，`class`文件在文件开头有特定的文件标志。
2. `ClassLoader`只负责`class`文件的加载，至于它是否运行，则由`Execution Engine`决定。
3. 加载的类信息存放于一块名为方法区的内存空间，除了类的信息外，方法区还包括运行时常量池信息，可能还包括字符串字面量和数字常量。

## 类加载器`ClassLoader`角色

1. `class file`存在于本地硬盘上，可以理解为模板，最终这个模板在执行时要加载到`JVM`种来根据这个文件实例化n个一模一样的实例。
2. `class file`加载到`JVM`中，被称为DNA元数据模板，放在方法区。
3. 在`class`文件->`JVM`->最终成为元数据模板，此过程需要一个运输工具，也就是类装载器，扮演一个快递员的角色。

## 类的加载过程

1. 加载：
    - 通过一个类的全限定名获取此类的二进制字节流；
    - 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构；
    - 在内存中生成一个代表这个类的`java.lang.Class`对象，作为方法区这个类的各种数据的访问入口。

2. 链接：
    - 验证：目的在于确保类文件的字节流中包含的信息符合当前虚拟机要求。
    - 准备：为类变量分配内存并且设置该类变量的默认初始值，即零值（不同的数据类型有不同的零值）。
    - 解析：将常量池内的符号引用转换为直接引用的过程。
    
3. 初始化：
    - 初始化阶段就是执行类构造器方法`<clinit>()`的过程；
    - 此方法不需要定义，是`javac`编译器自动收集类中所有类变量的赋值动作和静态代码块中的语句合并而来。
    - 该方法不同于对象构造器方法`init`；
    - 虚拟机必须保证一个类的该方法在多线程下被同步加锁。
    
## 类加载器的分类

1. `JVM`支持两种类的类加载器，分别为引导类加载器（Bootstrap Classloader）和自定义类加载器。
2. 从概念上讲，所有派生于抽象类`Classloader`的类加载器都划分为自定义类加载器。
3. 无论类加载器的类型如何划分，在程序中我们最常见的类加载器始终都只有三个。