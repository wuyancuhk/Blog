---
layout:     post
title:      "JVM - 操作数栈和动态链接"
subtitle:   " \"JVM Daily Notes - 08\""
date:       2021.01.02 12:29:00
author:     "Wuy"
header-img: "img/post-bg-2020.jpg"
catalog: true
tags:
    - 学习笔记
    - 读书
    - JVM

---

> *"Keep Learning JVM"*

# 虚拟机栈

##　操作数栈

1. 操作数栈是数组或链表实现的.
2. 每一个独立的栈帧中除了包含局部变量表以外,还包含一个后进先出的操作数栈,也叫做表达式栈;
3. 操作数栈在方法执行过程中,根据字节码指令,实现往栈中输入或提取数据;
4. 操作数栈,主要用于保存计算结果的中间结果,同时作为计算过程中变量的临时存储空间;
5. 操作数栈就是JVM执行引擎的一个工作区,当一个方法刚开始执行的时候,一个新的栈帧也会被随之创建出来,这个方法的操作数栈是空的;
6. 每一个操作数栈都会拥有一个明确的栈深度用于存储数值,其所需的最大深度在编译器就已经定义好了,保存在方法的`Code`属性中,为`max_stack`的值;
7. 栈中的任何一个元素都是可以任意的Java数据类型,其中,32bits占用一个栈单位深度,64bits占用两个栈单位深度;
8. 操作数栈并非采用访问数组索引的方式进行数据访问,而是只能进行出栈和入栈的操作;
9. 如果被调用的方法带有返回值的话,其返回值会被压入当前栈的操作数栈中,并更新PC寄存器中下一条需要执行的字节码指令.

### 常见问题

1. 如何解释`i++`和`++i`的区别?

   字节码指令的篇章再解释.

2. 由于操作数是存储在内存中的,因此频繁地执行内存地读/写操作必然会影响执行速度.为了解决这个问题,HotSpot的设计者提出了栈顶缓存的技术,将栈顶元素全部缓存到物理CPU寄存器中,以此降低对内存的读/写次数,提升执行引擎的执行效率

## 动态链接

1. 每一个栈帧内部都包含一个指向运行时常量池中该栈帧所属方法的引用.包含这个引用的目的就是为了支持当前方法的代码能够实现动态链接.
2. 在Java源文件被编译到字节码文件中时,所有的变量和方法引用都作为符号引用保存在`class`文件的常量池里,比如: 描述一个方法调用了另外其他方法时,就是通过常量池中指向方法的符号引用来表示的.那么动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用.

## 方法的调用

在JVM中,将符号引用转化为调用方法的直接引用与方法的绑定机制有关.

1. 静态链接(早期绑定)

   当一个字节码文件被装载进JVM内部的时候,如果被调用的目标方法在编译器可知,且运行期间保持不变时候,这种情况下将调用方法的符号引用转换为直接引用的过程叫做静态链接.

2. 动态链接(晚期绑定)

   如果被调用的方法在编译期无法被确定下来,也就是说,只能在程序运行期间将调用方法的符号引用转换为直接引用,由于这种引用的过程具有动态性,因此也就被叫做动态链接.