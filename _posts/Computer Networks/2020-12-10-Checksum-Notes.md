---
layout:     post
title:      "Computer Networks - History Notes"
subtitle:   " \"Computer Networks - Checksum\""
date:       2020.12.10 19:00:00
author:     "Wuy"
header-img: "img/post-bg-2020.jpg"
catalog: true
tags:
    - 学习笔记
    - 计算机网络



---

> *"Keep Learning Computer Networks"*

# 计算机网络中的三种错误检测方式

## 奇偶校验

要发送的信息 D 有 d 个比特。在偶校验方案中，发送方只需包含一个附加的比特，选择附加比特的值，使得这 d+1 个比特(初始信息加上一个校验比特)中 1 的总数是偶数。

接收方的操作也很简单。接收方只需要数一数接收的 d+1 比特中 1 的个数。

如果发现了奇数个值为 1 的比特，接收方知道了至少出现了一个比特差错。更确切的说法是，出现了奇数个差错比特。但是如果出现了偶数个比特差错，显然这种方法无法检测这种错误。

二维单比特奇偶校验方案中，D 中的 d 个比特被划分为 i 行 j 列。对每行和每列计算奇 偶值。产生的 i+j+1 奇偶比特构成了链路层帧的差错检测比特。这种方法可以检测和纠正 1 比特的错误。

## Checksum 简介

在 `IP` 、`UDP` 和 `TCP` 协议中，都有 `Checksum` 这个字段，用于校验数据的可靠性。下面主要讲一下 `Checksum` 的计算公式。

### 计算步骤

1. 获取数据包中被需要的字节数据，1字节为8位，将数据按照`8位+8位`的形式拼接并分组，例： 

    源数据：`7f 00 00 01 00 06 00 20 1F 91 F7 26 70 A7 34 F0`
    8位+8位：`7f00 0001 0006 0020 1F91 F726 70A7 34F0`

2. 将分组后的数据求和，溢出的高位与低位相加(高16位与低16位相加)，例：

    Sum = `7f00 + 0001 + 0006 + 0020 + 1F91 + F726 + 70A7 + 34F0`

    Sum = `23B75`

    高位溢出：`2`

    高低位相加：`3B75 + 2 = 3B77`

3. 将步骤2求得的结果取反，最后求得的值就是Checksum，例：

    3B77 转二进制：`11 1011 0111 0111`

    补足 16 位首部补 0 ：`0011 1011 0111 0111`

    取反：`1100 0100 1000 1000`

    Checksum 十六进制 = `c488`

## 循环冗余检测

### CRC校验概念

CRC即循环冗余校验码：是数据通信领域中最常用的一种查错校验码，其特征是信息字段和校验字段的长度可以任意选定。循环冗余检查（CRC）是一种数据传输检错功能，对数据进行多项式计算，并将得到的结果附在帧的后面，接收设备也执行类似的算法，以保证数据传输的正确性和完整性。

### CRC校验原理

其根本思想就是先在要发送的帧后面附加一个数（这个就是用来校验的校验码，但要注意，这里的数也是二进制序列的，下同），生成一个新帧发送给接收端。当然，这个附加的数不是随意的，它要使所生成的新帧能与发送端和接收端共同选定的某个特定数整除（注意，这里不是直接采用二进制除法，而是采用一种称之为“ 模2除法”）。到达接收端后，再把接收到的新帧除以（同样采用“ 模2除法”）这个选定的除数。因为在发送端发送数据帧之前就已通过附加一个数，做了“去余”处理（也就已经能整除了），所以结果应该是没有余数。如果有余数，则表明该帧在传输过程中出现了差错。

模2除法与算术除法类似，但每一位除的结果不影响其它位，即不向上一位借位，所以实际上就是异或。在循环冗余校验码（CRC）的计算中有应用到模2除法。

### CRC校验步骤

CRC校验中有两个关键点，一是预先确定一个发送送端和接收端都用来作为除数的二进制比特串（或多项式），可以随机选择，也可以使用国际标准，但是最高位和最低位必须为1；二是把原始帧与上面计算出的除数进行模2除法运算，计算出CRC码。
具体步骤如下：
1. 选择合适的除数。
2. 看选定除数的二进制位数，然后再要发送的数据帧上面加上这个位数-1位的0，然后用新生成的帧以模2除法的方式除上面的除数，得到的余数就是该帧的CRC校验码。注意，余数的位数一定只比除数位数少一位，也就是CRC校验码位数比除数位数少一位，如果前面位是0也不能省略。
3. 将计算出来的CRC校验码附加在原数据帧后面，构建成一个新的数据帧进行发送；最后接收端在以模2除法方式除以前面选择的除数，如果没有余数，则说明数据帧在传输的过程中没有出错。

### CRC校验码计算示例

现假设选择的 CRC生成多项式为 $G（ X） = X^4 + X^3 + 1$，要求出二进制序列 10110011的 CRC校验码。下面是具体的计算过程 ：
1. 将多项式转化为二进制序列，由 $G（ X） = X^4 + X^3 + 1$可知二进制一种有五位，第4位、第三位和第零位分别为1，则序列为11001

2. 多项式的位数位5，则在数据帧的后面加上5-1位0，数据帧变为 101100110000，然后使用模2除法除以除数 11001，得到余数。

   ![image-20201210162448971](https://i.loli.net/2020/12/10/EI2tN4KaBv1uVGg.png)

3. 将计算出来的CRC校验码添加在原始帧的后面，真正的数据帧为101100110100，再把这个数据帧发送到接收端。

4. 接收端收到数据帧后，用上面选定的除数，用模2除法除去，验证余数是否为0，如果为0，则说明数据帧没有出错。